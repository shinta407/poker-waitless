# TPDS Player App - MVP仕様（ブラッシュアップ版）

**Version:** 2.0
**最終更新:** 2026-02-12
**対象:** Player側 LINEミニアプリ（エンドユーザー向け）
**開発フェーズ:** デモ版 → LIFF統合 → 本番リリース

---

## 改訂の背景

既存の技術仕様書（TPDS_PLAYER_TECHNICAL_SPEC.md）をベースに、以下の観点から見直しを実施：

1. **デモ版と本番版の明確な分離** - LIFF統合前でも価値を体験できるデモ版の定義
2. **不要な複雑さの削減** - MVP範囲の再検討（3-second ruleの適用）
3. **ユーザージャーニーの最適化** - 各画面で必要な情報と操作の絞り込み
4. **優先順位の明確化** - MoSCoW法による機能分類
5. **UI/UX改善提案** - 既存実装の問題点と解決策

---

## 1. App Purpose（再定義）

### 1.1 Single Clear Statement

**TPDS Player App は、台北のポーカープレイヤーが「満席で無駄足」を避けるために、リアルタイムで空席状況を確認し、リモートでウェイティングリストに登録できるLINEミニアプリです。**

### 1.2 Core Value Proposition

**プレイヤーにとっての価値：**
- 店舗に行く前に空席状況を確認できる（無駄足を避ける）
- 到着前にウェイティングリストに登録できる（待ち時間を最小化）
- LINE通知で呼び出しを受け取れる（店舗外で待機可能）

**店舗にとっての価値：**
- 事前チェックインにより来店確度が高いプレイヤーを集客
- 待機中プレイヤーが店内に留まらず、混雑を軽減
- Admin側のQRスキャンで登録時間を短縮（<3秒）

---

## 2. Target Users & Pain Points

### 2.1 Primary User: ポーカープレイヤー（台北在住）

**Persona:**
- 年齢: 25-45歳
- ポーカー頻度: 週1-3回
- デバイス: スマートフォン（LINE利用率99%）
- 言語: 中国語（繁体字）メイン、一部日本語・英語
- 行動パターン: 仕事終わりや週末に複数店舗を回る

### 2.2 Ranked Pain Points

| 優先度 | ペインポイント | 現在の影響 | MVP解決策 |
|--------|---------------|-----------|----------|
| 1 | 店舗に行ったら満席で無駄足 | 移動時間30分が無駄 | MAP画面でリアルタイム空席確認（🟢🟡🔴信号機） |
| 2 | 待ち時間が長すぎて諦める | 30分待ちで帰宅 | 事前チェックインで到着時刻を通知、順番が来たらLINE通知 |
| 3 | 複数店舗を比較したいが情報がない | 電話で確認する手間 | MAP画面で全店舗の混雑状況を一覧表示 |
| 4 | 呼び出されても聞こえない | 店内アナウンスに気付かず順番飛ばされる | LINE通知でスマホに確実に届く |
| 5 | 待ち順が分からず不安 | 「あと何人？」と店員に聞く | マイステータス画面で現在の順位をリアルタイム表示 |

### 2.3 Post-MVP Pain Points（今回は解決しない）

- レート別の待ち時間予測（データ蓄積後）
- 店舗のレビュー・評価機能（Phase 2）
- 友人との同時チェックイン（Phase 2）
- トーナメント情報の通知（Phase 2）

---

## 3. MVP Scope Statement（MoSCoW分類）

### 3.1 Must Have（デモ版 + LIFF統合で必須）

**MAP画面（リアルタイム空席確認）:**
- ✅ Google Maps上に店舗ピン表示
- ✅ 信号機ロジック（🟢緑=空席あり / 🟡黄=少し待ち / 🔴赤=混雑中）
- ✅ Admin側の卓状況更新がリアルタイムで反映（2秒以内）
- ✅ 店舗タップで詳細画面へ遷移

**店舗詳細画面（チェックイン準備）:**
- ✅ 店舗情報（名前、住所、営業時間）
- ✅ レート別の待ち人数表示（リアルタイム）
- ✅ レート選択ボタン（1/3, 2/5, 5/10+, トーナメント）
- ✅ 到着時間選択（15分後、30分後、45分後、1時間後）
- ✅ チェックインボタン（LINE認証必須）

**マイステータス画面（待ち状況確認）:**
- ✅ 現在の待ち順位を大きく表示
- ✅ リアルタイム順位更新（他のプレイヤーがキャンセルしたら繰り上がる）
- ✅ キャンセルボタン
- ✅ LINE通知ステータス表示

**LINE通知（呼び出しアラート）:**
- 🔄 Admin側で「呼び出し」ボタン → LINEトークに通知
- 🔄 通知内容: "順番が来ました！店舗: [店舗名] レート: [1/3]"
- 🔄 通知タップでマイステータス画面へ遷移

**多言語対応:**
- ✅ 中国語（繁体字）- デフォルト
- ✅ 日本語
- ✅ 英語

### 3.2 Should Have（デモ版後、LIFF統合前に追加）

**MAP画面の拡張:**
- ⏳ 店舗検索バー（名前で検索）
- ⏳ レートフィルター（1/3のみ表示、など）
- ⏳ 現在地ボタン（GPS取得して地図中心を移動）

**UI/UX改善:**
- ⏳ ローディングスピナー（データ取得中）
- ⏳ エラーメッセージ（ネットワークエラー、チェックイン失敗）
- ⏳ 成功フィードバック（チェックイン完了時の確認画面）

**マイステータス画面の拡張:**
- ⏳ 呼び出し予測時刻（平均待ち時間から計算）
- ⏳ 呼び出しモーダル（全画面で🔔アイコン表示）

### 3.3 Could Have（LIFF統合後、本番リリース前）

**利便性向上:**
- 📅 店舗のお気に入り登録（次回MAP画面で上部表示）
- 📅 最近チェックインした店舗（履歴から再チェックイン）
- 📅 使い方ガイド画面の充実（動画デモ、FAQ）

**通知の最適化:**
- 📅 10分経過アラート（呼び出し後、店舗に来ない場合の再通知）
- 📅 通知設定（バイブレーション、音）

### 3.4 Won't Have（今回のMVPには含めない）

**明確に延期する機能:**

❌ **GPS圏内チェック制限**
- 理由: MVP検証にGPS必須ではない。不正チェックイン防止はPhase 2で対応
- いつ追加: 不正利用が10%超えたら実装（測定後）

❌ **デポジット機能（LINE Pay統合）**
- 理由: 決済統合は複雑、MVP後にビジネスモデル検証してから
- いつ追加: 有料化判断後（6ヶ月後）

❌ **ブラックリスト機能**
- 理由: ユーザー数が少ない段階では不要、店舗側でBANリスト管理
- いつ追加: ユーザー数1000人超えたら（3ヶ月後）

❌ **プライオリティ・パス（優先権購入）**
- 理由: ビジネスモデル検証後に追加、課金機能は複雑
- いつ追加: 有料化検討時（6ヶ月後）

❌ **AIコンシェルジュ（店舗推薦）**
- 理由: 付加価値機能、MVP後に追加、OpenAI API統合が必要
- いつ追加: ユーザー満足度80%超えたら（6ヶ月後）

❌ **ユーザー履歴・統計（過去のチェックイン履歴）**
- 理由: データ蓄積後に価値が出る、初期は不要
- いつ追加: 3ヶ月分のデータ蓄積後

❌ **レビュー・評価機能**
- 理由: 店舗との関係性を損なうリスク、Phase 2でビジネス判断
- いつ追加: 店舗数20店舗超えたら検討

❌ **友人招待・紹介ボーナス**
- 理由: グロース施策、MVP後にユーザー獲得戦略を決めてから
- いつ追加: 成長フェーズ（6ヶ月後）

---

## 4. デモ版仕様（LIFF統合前）

### 4.1 デモ版の目的

**目標:**
- 投資家・店舗オーナーにコアバリューを体験してもらう
- 開発チームがUI/UXを検証する
- ユーザーテストで実際の使い勝手を確認

**制約:**
- LINE認証なし（モックユーザー名）
- チェックイン処理なし（画面遷移のみ）
- LINE通知なし（アプリ内モーダル表示で代替）

### 4.2 デモ版で含める機能

**MAP画面:**
- ✅ Google Maps表示（台北市中心）
- ✅ モック店舗データ（5店舗程度）
- ✅ 信号機ピン表示（🟢🟡🔴）
- ✅ 店舗タップで詳細画面へ遷移
- ✅ モックデータのリアルタイム更新（30秒ごとにランダム変更）

**店舗詳細画面:**
- ✅ 店舗情報表示
- ✅ レート選択
- ✅ 到着時間選択
- ✅ チェックインボタン（タップでモーダル表示: "デモ版ではチェックインできません"）

**マイステータス画面:**
- ✅ モック待ち順表示（例: 3位）
- ✅ モックカウントダウン（30秒ごとに順位が上がる演出）
- ✅ キャンセルボタン（タップでMAP画面に戻る）

**使い方ガイド:**
- ✅ アプリの使い方説明
- ✅ 信号機の見方
- ✅ チェックインの流れ

### 4.3 デモ版のUI改善点

**問題点と解決策:**

| 問題 | 解決策 |
|------|--------|
| MAP画面に検索バーとフィルターがあるが機能していない | デモ版では削除、LIFF統合後に実装 |
| 店舗詳細画面の待ち人数が静的 | モックデータでリアルタイム風の変化を演出（30秒ごとに±1） |
| チェックインボタンを押しても何も起きない | モーダルで「デモ版ではチェックインできません。本番版をお待ちください」と表示 |
| マイステータス画面が空 | モックデータで「あなたは3位です」と表示、30秒ごとに順位アップ |
| エラー処理がない | ローディング中はスピナー表示、エラー時は「データ取得エラー」と表示 |

### 4.4 デモ版の成功基準

**1週間以内に達成すべき目標:**
- 投資家5人にデモ、うち3人が「価値がわかる」とフィードバック
- 店舗オーナー2人にデモ、うち1人が「導入したい」と回答
- ユーザーテスト10人、うち8人が「使いやすい」と評価
- バグゼロ（画面遷移、データ表示）

---

## 5. LIFF統合後の本番版仕様

### 5.1 LIFF統合で追加される機能

**LINE認証フロー:**
1. ユーザーがLIFFアプリを開く
2. `liff.init()` 実行
3. 未ログインなら `liff.login()` でLINEログイン画面表示
4. ログイン後、`liff.getProfile()` でuserIdとdisplayNameを取得
5. userIdをSupabaseのwaitlist.user_idに保存

**実際のチェックイン処理:**
1. LINE認証チェック（未ログインならログイン画面へ）
2. LINEプロフィール取得（userId, displayName）
3. waitlist テーブルに INSERT:
   - store_id: 選択した店舗
   - user_id: LINE userId
   - user_name: LINE displayName
   - rate_preference: 選択したレート
   - arrival_estimation_minutes: 選択した到着時間
   - status: 'waiting'
4. マイステータス画面へ遷移

**LINE通知の実装:**
- Admin側で「呼び出し」ボタン → waitlist.status = 'called'
- Supabase Database Trigger → Edge Function実行
- Edge Function → LINE Messaging API呼び出し
- LINEトークにPush Message送信:
  - テキスト: "🔔 順番が来ました！店舗: [店舗名] レート: [1/3]"
  - ボタン: "ステータス確認" → LIFF URL（マイステータス画面）

### 5.2 セキュリティ要件

**LINE Channel Access Token の保護:**
- ❌ フロントエンドに保存しない
- ✅ Supabase Secretsに保存
- ✅ Edge Functionのみがアクセス可能

**RLSポリシー（Row Level Security）:**
- ユーザーは自分のwaitlistエントリのみ更新可能（キャンセルのみ）
- Admin側は全エントリを更新可能（呼び出し、座席着席）

**認証チェック:**
- チェックイン時にLINE認証必須
- キャンセル時にuser_idの一致を確認
- API呼び出し時にSupabase JWTで認証

### 5.3 エラーハンドリング

**チェックインエラー:**
- LINE認証失敗 → "LINEログインが必要です" と表示、ログイン画面へ
- Supabase INSERT失敗 → "チェックインに失敗しました。もう一度お試しください"
- 重複チェックイン（同じ店舗に既に登録済み） → "既にチェックイン済みです" と表示、マイステータス画面へ

**LINE通知エラー:**
- 通知送信失敗 → Admin側に赤い「失敗」アイコン表示、手動リトライ可能
- ユーザーがLINEアカウントをブロック → 通知スキップ、警告アイコン表示
- ネットワークタイムアウト → 3回リトライ（exponential backoff）

**リアルタイム同期エラー:**
- WebSocket切断 → 5秒以内に自動再接続、接続状態インジケーター表示
- データ取得エラー → "データ取得エラー。再読み込みしてください" と表示、リトライボタン

---

## 6. ユーザージャーニーの最適化

### Journey 1: 店舗を探してチェックイン（最頻ケース）

**シナリオ:** 仕事終わり、ポーカーをしたいプレイヤーが空いている店舗を探す

**ステップ:**
1. LINEリッチメニュー「🟢空席MAP」タップ → MAP画面表示（2秒）
2. 地図上で緑ピン（空席あり）を探す（5秒）
3. 店舗ピンタップ → 店舗詳細画面表示（1秒）
4. レート「1/3」タップ、到着時間「30分後」タップ（3秒）
5. 「チェックイン」ボタンタップ → LINE認証確認 → チェックイン完了（3秒）
6. マイステータス画面表示「あなたは3位です」（1秒）
7. **合計: 15秒**

**最適化ポイント:**
- MAP画面の初期表示を2秒以内に（現在地取得を非同期化）
- 店舗ピンタップ時の画面遷移を1秒以内に（データプリロード）
- チェックインボタンのレスポンスを即座に（楽観的UI更新）

### Journey 2: 呼び出し通知を受け取る

**シナリオ:** チェックイン後、順番が来たらLINE通知を受け取る

**ステップ:**
1. チェックイン後、マイステータス画面で待ち順を確認（5秒）
2. LINEトークを開いて他のことをする（10分）
3. 順番が来たらLINE通知受信「🔔 順番が来ました！」（即座）
4. 通知タップ → マイステータス画面表示（2秒）
5. 「順番が来ました！店舗にお越しください」表示（3秒）
6. 店舗へ移動開始（5分）
7. **合計: 15分20秒**

**最適化ポイント:**
- LINE通知の配信速度を2秒以内に（Admin側の呼び出しボタンから）
- 通知タップ時のLIFF起動を2秒以内に（事前初期化）
- マイステータス画面の呼び出しモーダルを全画面で目立たせる

### Journey 3: キャンセル（急な予定変更）

**シナリオ:** チェックイン後、急な予定が入りキャンセルしたい

**ステップ:**
1. LINEリッチメニュー「⏳マイステータス」タップ → マイステータス画面表示（2秒）
2. 「キャンセル」ボタンタップ → 確認ダイアログ表示（1秒）
3. 「はい、キャンセルします」タップ → キャンセル処理（2秒）
4. MAP画面に戻る（1秒）
5. **合計: 6秒**

**最適化ポイント:**
- キャンセルボタンを目立つ位置に配置（赤色、下部）
- 確認ダイアログでキャンセル理由を聞かない（ワンタップでキャンセル）
- キャンセル後の画面遷移をスムーズに（MAP画面に戻る）

### Journey 4: 複数店舗を比較（新規ユーザー）

**シナリオ:** 初めてアプリを使うユーザーが複数店舗を比較したい

**ステップ:**
1. LINEリッチメニュー「🟢空席MAP」タップ → MAP画面表示（2秒）
2. 地図上の全店舗ピンを見る（10秒）
3. 緑ピン（空席あり）の店舗Aタップ → 詳細確認「待ち2人」（3秒）
4. 戻るボタンでMAP画面に戻る（1秒）
5. 別の緑ピンの店舗Bタップ → 詳細確認「待ち0人」（3秒）
6. 店舗Bでチェックイン（15秒）
7. **合計: 34秒**

**最適化ポイント:**
- MAP画面で待ち人数を直接表示（ピンタップ不要で比較可能）
- 店舗詳細画面から戻る時のMAP状態を保持（スクロール位置、選択状態）
- レートフィルターで絞り込み可能に（Phase 2）

---

## 7. UI/UX改善提案

### 7.1 MAP画面の改善

**現状の問題:**
- 検索バーとフィルターが実装されているが、デモ版では機能していない
- 店舗ピンをタップしても詳細が分からない（タップして初めて情報取得）

**改善案:**

**Phase 1（デモ版）:**
- 検索バーとフィルターを削除（混乱を避ける）
- 店舗ピンタップ時に簡易カード表示（名前、待ち人数、レート）
- カードタップで詳細画面へ遷移

**Phase 2（LIFF統合後）:**
- 検索バー復活（店舗名で検索）
- レートフィルター復活（1/3のみ表示、など）
- 現在地ボタン追加（GPS取得して地図中心を移動）

**Phase 3（本番リリース後）:**
- 店舗リスト表示（MAP/リスト切り替えボタン）
- 距離順ソート（現在地からの距離）
- お気に入り店舗を上部に固定表示

### 7.2 店舗詳細画面の改善

**現状の問題:**
- 待ち人数が静的（リアルタイム更新されているが、視覚的フィードバックがない）
- チェックインボタンのレスポンスが遅い（ネットワーク待ち）

**改善案:**

**Phase 1（デモ版）:**
- 待ち人数の横に🔄アイコン表示（リアルタイム更新中を示す）
- チェックインボタンタップ時に楽観的UI更新（即座に成功画面表示、裏で処理）

**Phase 2（LIFF統合後）:**
- 待ち人数が変化した時にアニメーション（数字が滑らかに変わる）
- チェックインボタンのローディングスピナー表示

**Phase 3（本番リリース後）:**
- 到着時間の推奨表示（現在地からの距離と交通状況から計算）
- レート別の平均待ち時間表示（過去データから予測）

### 7.3 マイステータス画面の改善

**現状の問題:**
- 待ち順が数字のみ（視覚的に分かりにくい）
- 呼び出し予測時刻がない（いつ呼ばれるか不安）

**改善案:**

**Phase 1（デモ版）:**
- 待ち順を大きく表示（96pt、画面中央）
- 「あなたは3位です」のような文言追加

**Phase 2（LIFF統合後）:**
- 呼び出し予測時刻表示（平均待ち時間から計算）
- プログレスバー表示（例: 3/10人目）

**Phase 3（本番リリース後）:**
- 呼び出しモーダルの全画面表示（緑背景、🔔アイコン、振動）
- 10分経過アラート（呼び出し後、店舗に来ない場合の再通知）

### 7.4 使い方ガイド画面の改善

**現状の問題:**
- テキストのみで分かりにくい

**改善案:**

**Phase 1（デモ版）:**
- イラスト追加（MAP画面、店舗詳細、マイステータスのスクリーンショット）
- ステップ番号表示（1→2→3→4）

**Phase 2（LIFF統合後）:**
- 動画デモ追加（30秒の使い方動画）
- FAQ追加（よくある質問）

**Phase 3（本番リリース後）:**
- インタラクティブチュートリアル（初回起動時に表示）

### 7.5 エラーハンドリングの改善

**現状の問題:**
- エラー処理がない（ネットワークエラー、チェックイン失敗時の挙動が不明）

**改善案:**

**Phase 1（デモ版）:**
- ローディングスピナー表示（データ取得中）
- エラーメッセージ表示（"データ取得エラー。再読み込みしてください"）

**Phase 2（LIFF統合後）:**
- リトライボタン追加（エラー時に再試行）
- 接続状態インジケーター（WebSocket接続中/切断中）

**Phase 3（本番リリース後）:**
- オフラインモード（最後に取得したデータをキャッシュ表示）
- エラーログ送信（Sentryなどでエラー監視）

---

## 8. パフォーマンス最適化

### 8.1 初期表示速度

**目標: 2秒以内にMAP画面表示**

**最適化手法:**
1. **コード分割**: Next.js Dynamic Importで初回読み込みを最小化
2. **画像最適化**: next/imageでWebP変換、遅延読み込み
3. **API並列化**: 店舗データとテーブルデータを並列取得
4. **キャッシュ**: SWRでデータキャッシュ、stale-while-revalidate

### 8.2 リアルタイム更新の効率化

**目標: 100人同時接続でも遅延<2秒**

**最適化手法:**
1. **デバウンス**: 300msで再レンダリング頻度削減
2. **メモ化**: useMemoで信号機ロジックの計算最適化
3. **チャネル分離**: MAP画面は全店舗、店舗詳細は特定店舗のみ購読
4. **差分更新**: 変更があったエントリのみ更新（全リスト再取得しない）

### 8.3 ネットワーク最適化

**目標: モバイル4G環境でも快適動作**

**最適化手法:**
1. **GraphQL化**: Supabaseクエリで必要なフィールドのみ取得
2. **圧縮**: Gzip/Brotli圧縮でペイロードサイズ削減
3. **CDN**: Vercel EdgeでJavaScript/CSS配信
4. **WebSocket最適化**: Heartbeat間隔を30秒に設定（Supabase Realtime）

---

## 9. アクセシビリティ対応

### 9.1 基本要件（WCAG 2.1 AA準拠）

**コントラスト比:**
- テキスト: 最低4.5:1（通常サイズ）、3:1（大サイズ）
- ボタン: 最低3:1

**タップターゲット:**
- ボタン: 最低44x44px（iOS HIG準拠）
- リンク: 最低44x44px

**フォーカス管理:**
- キーボードナビゲーション対応
- フォーカス可視化（青枠表示）

### 9.2 多言語対応

**対応言語:**
- 中国語（繁体字）- デフォルト、台湾ユーザー向け
- 日本語 - 日本人観光客向け
- 英語 - 国際観光客向け

**実装:**
- next-intlで翻訳ファイル管理
- ブラウザ言語設定から自動判定
- 手動切り替え（Phase 2で追加）

---

## 10. 開発ロードマップ（改訂版）

### Phase 1: デモ版完成（Week 1-2完了 → Week 3で改善）

**目標:** 投資家・店舗オーナーにデモ可能な状態

**残タスク:**
- [ ] 検索バー・フィルターの削除（デモ版）
- [ ] モックデータのリアルタイム更新演出
- [ ] チェックインボタンのモーダル表示
- [ ] マイステータス画面のモックデータ表示
- [ ] エラーハンドリング追加（ローディング、エラーメッセージ）

**成果物:**
- デモ用URL（Vercelにデプロイ）
- 1ページ説明資料（デモの見せ方）

**期間:** 1週間

---

### Phase 2: LIFF統合（Week 4-5）

**目標:** LINE認証とチェックイン処理の実装

**タスク:**
- [ ] LIFF SDK統合（@line/liff）
- [ ] LINE認証フロー実装
- [ ] チェックイン処理実装（waitlist INSERT）
- [ ] キャンセル処理実装（waitlist UPDATE）
- [ ] RLSポリシー設定（user_idベース）
- [ ] エラーハンドリング強化（認証エラー、チェックインエラー）

**成果物:**
- LIFF App登録（LINE Developers）
- 本番用URL（player.tpds.app）
- テストアカウントで動作確認

**期間:** 2週間

---

### Phase 3: LINE通知実装（Week 6）

**目標:** 呼び出し通知の送信

**タスク:**
- [ ] Supabase Edge Function作成（send-line-notification）
- [ ] Database Trigger設定（waitlist.status='called'）
- [ ] LINE Messaging API統合
- [ ] 通知メッセージテンプレート作成
- [ ] エラーハンドリング（通知失敗、リトライ）

**成果物:**
- Edge Functionデプロイ
- LINE Official Account作成
- Channel Access Token取得
- 通知送信テスト完了

**期間:** 1週間

---

### Phase 4: UI/UX改善（Week 7-8）

**目標:** Should Have機能の追加、UIポリッシュ

**タスク:**
- [ ] MAP画面: 検索バー・フィルター復活
- [ ] 店舗詳細画面: 待ち人数のアニメーション
- [ ] マイステータス画面: 呼び出し予測時刻表示
- [ ] 呼び出しモーダル: 全画面表示
- [ ] ローディング・エラー状態の改善
- [ ] パフォーマンス最適化（デバウンス、メモ化）

**成果物:**
- UIポリッシュ完了
- パフォーマンステスト完了（Lighthouse 90+）
- ユーザーテスト実施（10人）

**期間:** 2週間

---

### Phase 5: テスト＆リリース（Week 9-10）

**目標:** 本番リリース準備

**タスク:**
- [ ] 結合テスト（Admin側との連携確認）
- [ ] ストレステスト（100人同時接続）
- [ ] セキュリティテスト（RLSポリシー、認証フロー）
- [ ] 多言語テスト（日本語、英語）
- [ ] LINE Official Account公開申請
- [ ] LINEリッチメニュー作成
- [ ] ユーザー向けヘルプドキュメント作成

**成果物:**
- 本番リリース完了
- LINE公式アカウント公開
- ヘルプドキュメント公開

**期間:** 2週間

---

## 11. 成功指標（KPI）

### 11.1 ビジネス指標（3ヶ月後の目標）

| 指標 | 目標 | 測定方法 |
|------|------|----------|
| アクティブユーザー数 | 500人/月 | Supabaseログ |
| チェックイン数 | 1000回/月 | waitlistテーブル |
| LINE通知配信成功率 | >95% | Edge Functionログ |
| ユーザー満足度（NPS） | >40 | アプリ内アンケート |
| 店舗採用数 | 10店舗 | Adminアクティブストア数 |

### 11.2 技術指標（継続監視）

| 指標 | 目標 | 測定方法 |
|------|------|----------|
| 初期表示速度 | <2秒 | Lighthouse |
| リアルタイム更新遅延 | <2秒 | Admin操作からPlayer反映まで |
| エラー率 | <1% | Sentry |
| WebSocket接続率 | >99% | Supabase Realtime監視 |
| モバイルLighthouseスコア | >90 | Lighthouse |

### 11.3 ユーザー行動指標

**Week 1目標:**
- 10人がデモ版を使用
- 5人が「使いやすい」とフィードバック
- バグゼロ

**Month 1目標:**
- 100人がチェックイン
- 50人が2回以上チェックイン（リピート率50%）
- 平均チェックインから呼び出しまで15分

**失敗シグナル（ピボット判断）:**
- チェックイン率<10%（MAP閲覧だけで終わる）
- キャンセル率>50%（チェックインしても来ない）
- 店舗からクレーム（不正利用、データ不正確）

---

## 12. リスク管理

### 12.1 技術リスク

| リスク | 影響 | 対策 |
|--------|------|------|
| LIFF初期化失敗 | HIGH - アプリ起動不可 | フォールバックUI表示、エラーログ送信 |
| LINE通知配信失敗 | HIGH - コア機能停止 | リトライロジック、Admin側に失敗通知 |
| Supabase Realtime切断 | MEDIUM - データ遅延 | 自動再接続、接続状態表示 |
| Google Maps API制限 | LOW - MAP表示不可 | 無料枠内で運用、超過時にアラート |

### 12.2 ビジネスリスク

| リスク | 影響 | 対策 |
|--------|------|------|
| 不正チェックイン（GPS外から） | HIGH - 店舗信頼喪失 | Phase 2でGPS制限実装 |
| ユーザー獲得失敗 | HIGH - サービス継続不可 | 店舗スタッフ経由でQR配布、LINE広告 |
| 店舗離脱（Admin不採用） | HIGH - データ不足 | 導入インセンティブ（初月無料） |
| 競合出現 | MEDIUM - シェア獲得困難 | 先行者利益、店舗囲い込み |

---

## 13. 付録: デザイン仕様

### 13.1 カラーパレット

**Primary Colors:**
- Green（空席）: #34C759
- Yellow（少し待ち）: #FFCC00
- Red（混雑）: #FF3B30
- Blue（アクセント）: #007AFF

**UI Colors:**
- Background: #FFFFFF
- Text Primary: #000000
- Text Secondary: #8E8E93
- Border: #E5E5EA

### 13.2 Typography

**フォント:**
- システムフォント（-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto）
- 中国語: Noto Sans TC
- 日本語: Noto Sans JP

**サイズ:**
- H1（ページタイトル）: 32px, Bold
- H2（セクションタイトル）: 24px, Semibold
- Body（本文）: 16px, Regular
- Small（補助テキスト）: 14px, Regular
- Large Number（待ち順）: 96px, Heavy

### 13.3 コンポーネント仕様

**ボタン:**
- Primary: Blue背景、白文字、角丸8px、高さ48px
- Secondary: 白背景、Blue枠、Blue文字、角丸8px、高さ48px
- Destructive: Red背景、白文字、角丸8px、高さ48px

**カード:**
- 白背景、グレー枠1px、角丸12px、影あり
- パディング: 16px

**アイコン:**
- サイズ: 24x24px（通常）、48x48px（大）
- スタイル: Line（線画）

---

## 14. 開発チェックリスト

### デモ版リリース前

**機能:**
- [ ] MAP画面表示（Google Maps + モック店舗）
- [ ] 店舗詳細画面表示
- [ ] マイステータス画面表示（モックデータ）
- [ ] 使い方ガイド画面表示

**UI/UX:**
- [ ] ローディングスピナー表示
- [ ] エラーメッセージ表示
- [ ] モバイル対応（レスポンシブ）

**品質:**
- [ ] バグゼロ（画面遷移、データ表示）
- [ ] Lighthouseスコア>80
- [ ] 10人のユーザーテスト完了

---

### LIFF統合前

**準備:**
- [ ] LINE Developers登録
- [ ] LIFF App作成
- [ ] LINE Official Account作成
- [ ] Messaging API有効化
- [ ] Channel Access Token取得

**実装:**
- [ ] LIFF SDK統合
- [ ] LINE認証フロー実装
- [ ] チェックイン処理実装
- [ ] RLSポリシー設定

---

### 本番リリース前

**機能:**
- [ ] LINE通知送信テスト完了
- [ ] Admin側との連携確認
- [ ] エラーハンドリング完備

**テスト:**
- [ ] 結合テスト完了
- [ ] ストレステスト完了（100人同時）
- [ ] セキュリティテスト完了

**運用:**
- [ ] 監視ツール設定（Sentry, Vercel Analytics）
- [ ] ヘルプドキュメント公開
- [ ] 緊急連絡体制確立

---

## 15. まとめ: 次のアクション

### 即座に実施すべきこと（今週）

1. **デモ版のUI改善**
   - 検索バー・フィルターの削除
   - モックデータのリアルタイム更新演出
   - エラーハンドリング追加

2. **LINE開発者登録**
   - LIFF App作成
   - Channel Access Token取得

3. **投資家デモ準備**
   - デモシナリオ作成
   - 1ページ説明資料作成

### 来週以降のアクション

1. **LIFF統合（Week 4-5）**
2. **LINE通知実装（Week 6）**
3. **UI/UX改善（Week 7-8）**
4. **テスト＆リリース（Week 9-10）**

---

**ドキュメントバージョン:**
- v2.0（2026-02-12）: MVP仕様ブラッシュアップ版作成

**次回レビュー日:**
- デモ版完成後（Week 3終了時）

---

**END OF REFINED SPECIFICATION**

**Ready to ship the demo? Let's make Taipei poker players love this app.**
